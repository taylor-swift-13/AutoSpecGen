# AutoSpecGen
Using large language models to generate ACSL specifications for C code



### 迭代：

进行n次生成，每次生成注释后进行 m 次迭代修复，直到得到正确的规约

总的最大调用大模型次数：生成次数 m *（1 + 修复次数 n）



### base：

只包含简单的指令



### pro：

加入简单的 ACSL 语法规则

加入简单的 cot 

加入简单的examples



### ultra：

在 prompt 中加入逻辑谓词的学习

在 prompt 中进一步细化：

1. 任务分解

2. 结构化
3. 详细的 ACSL  语法规则，配合示例与反例



实验中发现语义修复迭代的效果不佳并且占用大量的LLM调用次数

是因为在修复错误时有可能又导致语法错误，很多 IP 程序本身 frama-c 也无法验证等原因

因此关注语法错误的修复，可以降低大模型的调用次数达到更好结果



### 不足：

两个 IP 的交互方式，IP a 中变量的地址传给 IP b 的结构体内部的指针，IP b 通过函数指针调用 b 函数修改自己内部的指针指向的值从而修改 a 中的变量,  但 frama-c  -wp 无法支持函数指针



| 模型名称    | 版本  | 生成次数 | 修复次数 | 语法准确率 (syntax_accuracy) | 循环准确率 (loop_accuracy) | 断言准确率 (assert_accuracy) | 后置条件准确率 (post_accuracy) | 总准确率 (total_accuracy) | 总LLM次数 | 总生成时间 (s) | 总验证时间 (s) | 平均LLM次数 | 平均生成时间 (s) | 平均验证时间 (s) |
| ----------- | ----- | -------- | -------- | ---------------------------- | -------------------------- | ---------------------------- | ------------------------------ | ------------------------- | --------- | -------------- | -------------- | ----------- | ---------------- | ---------------- |
| gpt-4o-mini | pro   | 1        | 0        | 8.00% (4/50)                 | 0.00% (0/0)                | 75.00% (3/4)                 | 80.95% (17/21)                 | 80.00% (20/25)            | 50        | 445.83         | 60.39          | 1.00        | 8.92             | 1.21             |
| gpt-4o-mini | base  | 1        | 0        | 4.00% (2/50)                 | 100.00% (1/1)              | 16.67% (2/12)                | 94.44% (17/18)                 | 64.52% (20/31)            | 50        | 406.99         | 57.83          | 1.00        | 8.14             | 1.16             |
| gpt-4o-mini | pro   | 4        | 0        | 18.00% (9/50)                | 100.00%  (4/4)             | 57.89% (22/38)               | 89.29% (25/28)                 | 72.86% (51/70)            | 191       | 2040.03        | 185.34         | 3.82        | 40.80            | 3.71             |
| gpt-4o-mini | base  | 4        | 0        | 18.00% (9/50)                | 0.00% (0/0)                | 29.55% (13/44)               | 62.50% (20/32)                 | 43.42% (33/76)            | 199       | 1891.22        | 339.64         | 3.98        | 37.82            | 6.79             |
| gpt-4o-mini | pro   | 2        | 1        | 26.00% (13/50)               | 62.50% (5/8)               | 71.88% (23/32)               | 82.14% (23/28)                 | 75.00% (51/68)            | 186       | 5460.19        | 294.46         | 3.72        | 109.20           | 5.89             |
| gpt-4o-mini | base  | 2        | 1        | 26.00% (13/50)               | 0.00% (0/0)                | 52.86% (37/70)               | 58.14% (25/43)                 | 54.87% (62/113)           | 198       | 2419.78        | 313.58         | 3.96        | 48.40            | 6.27             |
| gpt-4o-mini | pro   | 1        | 3        | 34.00% (17/50)               | 71.43%  (5/7)              | 67.53% (52/77)               | 72.50% (29/40)                 | 69.35% (86/124)           | 191       | 2307.94        | 343.63         | 3.82        | 46.16            | 6.87             |
| gpt-4o-mini | base  | 1        | 3        | 18.00% (9/50)                | 100.00%  (2/2)             | 61.76% (21/34)               | 81.48% (22/27)                 | 71.43% (45/63)            | 197       | 2971.01        | 126.63         | 3.94        | 59.42            | 2.53             |
| gpt-4o      | pro   | 1        | 3        | 84.00% (42/50)               | 55.56% (15/27)             | 59.49% (116/195)             | 47.50% (57/120)                | 54.97%(188/342)           | 158       | 5985.90        | 1216.13        | 3.16        | 119.72           | 24.32            |
| deepseek-v3 | pro   | 1        | 3        | 54.00%(27/50)                | 40.00%(2/5)                | 62.50% (80/128)              | 54.05%(20/37)                  | 60.00%(102/170)           | 183       | 7150.40        | 677.28         | 3.66        | 143.01           | 13.55            |
| gpt-4o-mini | ultra | 1        | 3        | 64.00%(32/50)                | 76.74%(13/17)              | 41.56%(64/154)               | 60.98%(25/41)                  | 48.11%(102/212)           | 129       | 2148.22        | 902.59         | 2.58        | 42.96            | 18.05            |
| gpt-4o      | ultra | 1        | 3        | 90.00%(45/50)                | 61.29%(19/31)              | 52.96%(152/287)              | 52.11%(37/71)                  | 53.47%(208/389)           | 90        | 2526.40        | 1421.34        | 1.80        | 50.53            | 28.43            |
| deepseek-v3 | ultra | 1        | 3        | 90.00%(45/50)                | 57.14%(24/42)              | 60.47%(203/334)              | 47.62%(20/42)                  | 58.87%(247/418)           | 88        | 4119.27        | 1451.49        | 1.76        | 82.39            | 29.03            |
| gpt-4o-mini | ultra | 1        | 0        | 20.00% (10/50)               | 92.31%  (12/13)            | 76.67% (46/60)               | 75.00% (6/8)                   | 79.01% (64/81)            | 50        | 834.07         | 303.95         | 1.00        | 16.68            | 6.08             |
| gpt-4o      | ultra | 1        | 0        | 60.00% (30/50)               | 81.25%  (13/16)            | 48.92% (68/139)              | 66.04% (35/53)                 | 55.77%(116/208)           | 50        | 1442.35        | 825.03         | 1.00        | 28.85            | 16.50            |
| deepseek-v3 | ultra | 1        | 0        | 52.00% (26/50)               | 63.64%  (7/11)             | 56.99% (106/186)             | 95.00% (19/20)                 | 60.83%(132/217)           | 50        | 2180.66        | 878.66         | 1.00        | 43.61            | 17.57            |
| gpt-4o-mini | ultra | 1        | 5       | 66.00% (33/50)                  | 79.17% (19/24)                | 72.61% (114/157)                | 44.44% (8/18)                  | 70.85% (141/199)           | 183       | 3359.90        | 727.32         | 3.66        | 67.20            | 14.55            |
| gpt-4o | ultra | 1 | 5 | 94.00% (47/50) | 55.26% (21/38) | 58.01% (181/312) | 58.33% (49/84) | 57.83% (251/434) | 86 | 2472.80 | 1415.43 | 1.72 | 49.46 | 28.31 |
| deepseek-v3 | ultra | 1 | 5 | 88.00% (44/50) | 70.00% (28/40) | 60.39% (218/361) | 42.86% (18/42) | 59.59% (264/443) | 121 | 4779.50 | 1484.38 | 2.42 | 95.59 | 29.69 |