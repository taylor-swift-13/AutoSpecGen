# AutoSpecGen
Using large language models to generate ACSL specifications for C code



### 迭代：

进行n次生成，每次生成注释后进行 m 次迭代修复，直到得到正确的规约

总的最大调用大模型次数：生成次数 m *（1 + 修复次数 n）



### base：

只包含简单的指令



### pro：

加入 ACSL 语法规则

加入简单的 cot 

加入简单的examples



### ultra：

在 prompt 中加入逻辑谓词的学习

实验中发现语义修复迭代的效果不佳并且占用大量的LLM调用次数，因此关注语法错误的修复，降低大模型的调用次数达到更好结果

在 prompt 中进一步细化加入任务分解以及格式化



### 不足：

无法处理 IP 风格的函数调用（依靠指针别名传递信息）



| 模型名称    | 版本  | 生成次数 | 修复次数 | 语法准确率 (syntax_accuracy) | 循环准确率 (loop_accuracy) | 断言准确率 (assert_accuracy) | 后置条件准确率 (post_accuracy) | 总准确率 (total_accuracy) | 总LLM次数 | 总生成时间 (s) | 总验证时间 (s) | 平均LLM次数 | 平均生成时间 (s) | 平均验证时间 (s) |
| ----------- | ----- | -------- | -------- | ---------------------------- | -------------------------- | ---------------------------- | ------------------------------ | ------------------------- | --------- | -------------- | -------------- | ----------- | ---------------- | ---------------- |
| gpt-4o-mini | pro   | 1        | 0        | 8.00% (4/50)                 | 0.00% (0/0)                | 75.00% (3/4)                 | 80.95% (17/21)                 | 80.00% (20/25)            | 50        | 445.83         | 60.39          | 1.00        | 8.92             | 1.21             |
| gpt-4o-mini | base  | 1        | 0        | 4.00% (2/50)                 | 100.00% (1/1)              | 16.67% (2/12)                | 94.44% (17/18)                 | 64.52% (20/31)            | 50        | 406.99         | 57.83          | 1.00        | 8.14             | 1.16             |
| gpt-4o-mini | pro   | 4        | 0        | 18.00% (9/50)                | 100.00%  (4/4)             | 57.89% (22/38)               | 89.29% (25/28)                 | 72.86% (51/70)            | 191       | 2040.03        | 185.34         | 3.82        | 40.80            | 3.71             |
| gpt-4o-mini | base  | 4        | 0        | 18.00% (9/50)                | 0.00% (0/0)                | 29.55% (13/44)               | 62.50% (20/32)                 | 43.42% (33/76)            | 199       | 1891.22        | 339.64         | 3.98        | 37.82            | 6.79             |
| gpt-4o-mini | pro   | 2        | 1        | 26.00% (13/50)               | 62.50% (5/8)               | 71.88% (23/32)               | 82.14% (23/28)                 | 75.00% (51/68)            | 186       | 5460.19        | 294.46         | 3.72        | 109.20           | 5.89             |
| gpt-4o-mini | base  | 2        | 1        | 26.00% (13/50)               | 0.00% (0/0)                | 52.86% (37/70)               | 58.14% (25/43)                 | 54.87% (62/113)           | 198       | 2419.78        | 313.58         | 3.96        | 48.40            | 6.27             |
| gpt-4o-mini | pro   | 1        | 3        | 34.00% (17/50)               | 71.43%  (5/7)              | 67.53% (52/77)               | 72.50% (29/40)                 | 69.35% (86/124)           | 191       | 2307.94        | 343.63         | 3.82        | 46.16            | 6.87             |
| gpt-4o-mini | base  | 1        | 3        | 18.00% (9/50)                | 100.00%  (2/2)             | 61.76% (21/34)               | 81.48% (22/27)                 | 71.43% (45/63)            | 197       | 2971.01        | 126.63         | 3.94        | 59.42            | 2.53             |
| gpt-4o      | pro   | 1        | 3        | 84.00% (42/50)               | 55.56% (15/27)             | 59.49% (116/195)             | 47.50% (57/120)                | 54.97%(188/342)           | 158       | 5985.90        | 1216.13        | 3.16        | 119.72           | 24.32            |
| deepseek-v3 | pro   | 1        | 3        | 54.00%(27/50)                | 40.00%(2/5)                | 62.50% (80/128)              | 54.05%(20/37)                  | 60.00%(102/170)           | 183       | 7150.40        | 677.28         | 3.66        | 143.01           | 13.55            |
| gpt-4o      | ultra | 1        | 3        | 88.00%(44/50)                | 61.29%(19/31)              | 53.52%(152/284)              | 51.43%(207/385)                | 53.77%(207/385)           | 89        | 2476.48        | 1380.35        | 1.78        | 49.53            | 27.61            |
| gpt-4o-mini | ultra | 1        | 3        | 62.00%(31/50)                | 76.74%(13/17)              | 42.38%(64/151)               | 60.98%(25/41)                  | 48.80%(102/209)           | 128       | 2099.47        | 861.73         | 2.56        | 41.99            | 17.23            |
| deepseek-v3 | ultra | 1        | 3        | 88.00%(44/50)                | 57.14%(24/42)              | 60.78%(203/334)              | 47.62%(20/42)                  | 59.09%(247/418)           | 87        | 4050.66        | 1410.41        | 1.74        | 81.01            | 28.21            |

